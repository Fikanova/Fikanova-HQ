---
import Layout from '../layouts/Layout.astro';

const categories = ['All', 'AI Agents', 'Templates', 'Tools'];

const products = [
    { id: 1, name: 'Sales Agent Template', description: 'Pre-configured n8n workflow for lead qualification.', price: 5000, category: 'AI Agents', icon: 'ðŸ¤–' },
    { id: 2, name: 'CFO Dashboard Template', description: 'Financial tracking with KRA tax calculations.', price: 3500, category: 'Templates', icon: 'ðŸ’°' },
    { id: 3, name: 'Marketing Automation Pack', description: 'Social media scheduling and content generation.', price: 7500, category: 'AI Agents', icon: 'ðŸ“¢' },
    { id: 4, name: 'Landing Page Kit', description: 'Modern responsive templates with Tailwind CSS.', price: 2500, category: 'Templates', icon: 'ðŸŽ¨' },
    { id: 5, name: 'Customer Support Bot', description: 'Botpress chatbot with FAQ handling.', price: 8000, category: 'AI Agents', icon: 'ðŸ’¬' },
    { id: 6, name: 'Invoice Generator', description: 'Automated invoicing with eTIMS compliance.', price: 4000, category: 'Tools', icon: 'ðŸ“„' }
];
---

<Layout title="Digital Asset Store">
    <!-- Store Header -->
    <header class="store-header">
        <nav class="store-nav">
            <div class="store-logo">
                <a href="/"><img src="/assets/logos/fikanova-logo1.png" alt="Fikanova Store"></a>
            </div>
            
            <div class="store-categories">
                {categories.map(cat => (
                    <a href={`#${cat.toLowerCase().replace(' ', '-')}`} class="category-link">{cat}</a>
                ))}
            </div>
            
            <div class="store-actions">
                <a href="/login" class="store-link">Login</a>
                <a href="/signup" class="store-link">Sign Up</a>
                <button id="cartBtn" class="cart-btn">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cartCount" class="cart-count">0</span>
                </button>
            </div>
        </nav>
    </header>

    <!-- Hero -->
    <section class="store-hero">
        <div class="container">
            <h1>Templates & <span class="gradient-text">AI Agents</span></h1>
            <p>Ready-to-use workflows, templates, and automation tools to supercharge your business.</p>
        </div>
    </section>

    <!-- Products Grid -->
    <main class="store-main">
        <div class="container">
            <div class="products-grid" id="productsGrid">
                {products.map(product => (
                    <div class="product-card" data-category={product.category}>
                        <div class="product-icon">{product.icon}</div>
                        <span class="product-category">{product.category}</span>
                        <h3 class="product-name">{product.name}</h3>
                        <p class="product-desc">{product.description}</p>
                        <div class="product-footer">
                            <span class="product-price">KES {product.price.toLocaleString()}</span>
                            <button class="add-to-cart-btn" data-id={product.id} data-name={product.name} data-price={product.price}>
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="store-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <img src="/assets/logos/fikanova-logo1.png" alt="Fikanova" class="footer-logo">
                    <p>Digital products delivered instantly.</p>
                </div>
                <div class="footer-links">
                    <a href="https://fikanova.co.ke">Main Site</a>
                    <a href="https://app.fikanova.co.ke">Client Portal</a>
                    <a href="/contact">Contact</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Fikanova Store. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Cart Sidebar -->
    <div id="cartSidebar" class="cart-sidebar">
        <div class="cart-header">
            <h3>Your Cart</h3>
            <button id="closeCart" class="close-cart"><i class="fas fa-times"></i></button>
        </div>
        <div id="cartItems" class="cart-items"></div>
        <div class="cart-total">
            <span>Total:</span>
            <span id="cartTotal">KES 0</span>
        </div>
        <button class="checkout-btn">Proceed to Checkout</button>
    </div>
    <div id="cartOverlay" class="cart-overlay"></div>

    <style>
        .store-header {
            background: var(--dark-bg);
            border-bottom: 1px solid var(--border-subtle);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .store-nav {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
        }
        .store-logo img { height: 32px; }
        .store-categories {
            display: flex;
            gap: 24px;
        }
        .category-link {
            color: var(--text-secondary);
            font-weight: 500;
            transition: color 0.2s;
        }
        .category-link:hover { color: var(--primary); }
        .store-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .store-link {
            color: var(--text-secondary);
            font-weight: 500;
        }
        .store-link:hover { color: var(--primary); }
        .cart-btn {
            position: relative;
            background: var(--dark-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 12px 16px;
            color: var(--text-primary);
            cursor: pointer;
            transition: border-color 0.2s;
        }
        .cart-btn:hover { border-color: var(--primary); }
        .cart-count {
            position: absolute;
            top: -6px;
            right: -6px;
            background: var(--primary);
            color: white;
            font-size: 11px;
            font-weight: 600;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .store-hero {
            padding: 80px 24px;
            text-align: center;
        }
        .store-hero h1 { font-size: 48px; margin-bottom: 16px; }
        .store-hero p { color: var(--text-secondary); max-width: 600px; margin: 0 auto; }
        .store-main {
            padding: 0 24px 80px;
        }
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .product-card {
            background: var(--dark-card);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            padding: 24px;
            transition: transform 0.2s, border-color 0.2s;
        }
        .product-card:hover {
            transform: translateY(-4px);
            border-color: var(--primary);
        }
        .product-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
        .product-category {
            display: inline-block;
            background: rgba(139, 92, 246, 0.15);
            color: var(--primary);
            font-size: 12px;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 20px;
            margin-bottom: 12px;
        }
        .product-name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .product-desc {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 16px;
        }
        .product-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .product-price {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }
        .add-to-cart-btn {
            background: var(--primary);
            border: none;
            border-radius: 12px;
            padding: 12px 16px;
            color: white;
            cursor: pointer;
            transition: background 0.2s;
        }
        .add-to-cart-btn:hover { background: var(--primary-dark); }
        .store-footer {
            background: var(--dark-card);
            border-top: 1px solid var(--border-subtle);
            padding: 48px 24px 24px;
        }
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }
        .footer-logo { height: 32px; margin-bottom: 12px; }
        .footer-links { display: flex; gap: 24px; }
        .footer-links a { color: var(--text-secondary); }
        .footer-links a:hover { color: var(--primary); }
        .footer-bottom {
            max-width: 1200px;
            margin: 0 auto;
            padding-top: 24px;
            border-top: 1px solid var(--border-subtle);
            text-align: center;
            color: var(--text-tertiary);
        }
        /* Cart Sidebar */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: var(--dark-card);
            border-left: 1px solid var(--border-subtle);
            z-index: 200;
            transition: right 0.3s;
            display: flex;
            flex-direction: column;
        }
        .cart-sidebar.open { right: 0; }
        .cart-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .close-cart {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
        }
        .cart-items { flex: 1; overflow-y: auto; padding: 24px; }
        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-subtle);
        }
        .cart-total {
            padding: 24px;
            border-top: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-between;
            font-size: 18px;
            font-weight: 600;
        }
        .checkout-btn {
            margin: 0 24px 24px;
            padding: 16px;
            background: var(--primary);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }
        .cart-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 150;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s;
        }
        .cart-overlay.open { opacity: 1; visibility: visible; }
    </style>

    <script is:inline>
        let cart = JSON.parse(localStorage.getItem('store-cart') || '[]');
        
        function updateCartUI() {
            document.getElementById('cartCount').textContent = cart.length;
            const itemsDiv = document.getElementById('cartItems');
            const total = cart.reduce((sum, item) => sum + item.price, 0);
            document.getElementById('cartTotal').textContent = 'KES ' + total.toLocaleString();
            
            itemsDiv.innerHTML = cart.length === 0 
                ? '<p style="color: var(--text-secondary)">Your cart is empty</p>'
                : cart.map((item, i) => `
                    <div class="cart-item">
                        <span>${item.name}</span>
                        <span>KES ${item.price.toLocaleString()}</span>
                    </div>
                `).join('');
        }

        document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                cart.push({ id: btn.dataset.id, name: btn.dataset.name, price: parseInt(btn.dataset.price) });
                localStorage.setItem('store-cart', JSON.stringify(cart));
                updateCartUI();
                btn.innerHTML = '<i class="fas fa-check"></i>';
                setTimeout(() => btn.innerHTML = '<i class="fas fa-plus"></i>', 1000);
            });
        });

        document.getElementById('cartBtn').addEventListener('click', () => {
            document.getElementById('cartSidebar').classList.add('open');
            document.getElementById('cartOverlay').classList.add('open');
        });

        document.getElementById('closeCart').addEventListener('click', () => {
            document.getElementById('cartSidebar').classList.remove('open');
            document.getElementById('cartOverlay').classList.remove('open');
        });

        document.getElementById('cartOverlay').addEventListener('click', () => {
            document.getElementById('cartSidebar').classList.remove('open');
            document.getElementById('cartOverlay').classList.remove('open');
        });

        updateCartUI();
    </script>
</Layout>
