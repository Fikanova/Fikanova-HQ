{
    "name": "L1 - CEO Agent",
    "description": "Central command router for Human-Centric C-Suite. Routes WhatsApp commands to appropriate executives.",
    "nodes": [
        {
            "parameters": {
                "httpMethod": "POST",
                "path": "ceo-command",
                "responseMode": "responseNode"
            },
            "name": "WhatsApp Bridge Webhook",
            "type": "n8n-nodes-base.webhook",
            "position": [
                100,
                300
            ],
            "notes": "Receives from Appwrite whatsapp-bridge function"
        },
        {
            "parameters": {
                "text": "Analyze this command and determine the best C-Suite executive to handle it.\n\nCommand: {{$json.message}}\nFrom: {{$json.from_phone}}\n\nRespond with ONE of: Finance, Product, Marketing, Operations, Governance\n\n- Finance = CFO (money, runway, expenses, tax, KRA)\n- Product = CTO (tech, code, deploy, systems)\n- Marketing = CMO (content, social, newsletter, branding, drafts)\n- Operations = CIO (data, knowledge, daily briefs)\n- Governance = CimpO (ESG, compliance, audits)",
                "options": {}
            },
            "name": "Strategy Engine (Gemini)",
            "type": "@n8n/n8n-nodes-langchain.agent",
            "position": [
                300,
                300
            ]
        },
        {
            "parameters": {
                "rules": {
                    "values": [
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": false
                                },
                                "conditions": [
                                    {
                                        "leftValue": "={{$json.output}}",
                                        "rightValue": "Finance",
                                        "operator": {
                                            "type": "string",
                                            "operation": "contains"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": true,
                            "outputKey": "To_CFO"
                        },
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": false
                                },
                                "conditions": [
                                    {
                                        "leftValue": "={{$json.output}}",
                                        "rightValue": "Product",
                                        "operator": {
                                            "type": "string",
                                            "operation": "contains"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": true,
                            "outputKey": "To_CTO"
                        },
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": false
                                },
                                "conditions": [
                                    {
                                        "leftValue": "={{$json.output}}",
                                        "rightValue": "Marketing",
                                        "operator": {
                                            "type": "string",
                                            "operation": "contains"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": true,
                            "outputKey": "To_CMO"
                        },
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": false
                                },
                                "conditions": [
                                    {
                                        "leftValue": "={{$json.output}}",
                                        "rightValue": "Operations",
                                        "operator": {
                                            "type": "string",
                                            "operation": "contains"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": true,
                            "outputKey": "To_CIO"
                        },
                        {
                            "conditions": {
                                "options": {
                                    "caseSensitive": false
                                },
                                "conditions": [
                                    {
                                        "leftValue": "={{$json.output}}",
                                        "rightValue": "Governance",
                                        "operator": {
                                            "type": "string",
                                            "operation": "contains"
                                        }
                                    }
                                ],
                                "combinator": "and"
                            },
                            "renameOutput": true,
                            "outputKey": "To_CimpO"
                        }
                    ]
                },
                "fallbackOutput": "To_CEO_Self"
            },
            "name": "C-Suite Router",
            "type": "n8n-nodes-base.switch",
            "position": [
                500,
                300
            ]
        },
        {
            "name": "CFO Agent (Delegate)",
            "type": "n8n-nodes-base.executeWorkflow",
            "parameters": {
                "workflowId": "CFO_AGENT_ID"
            },
            "position": [
                700,
                100
            ]
        },
        {
            "name": "CTO Agent (Delegate)",
            "type": "n8n-nodes-base.executeWorkflow",
            "parameters": {
                "workflowId": "CTO_AGENT_ID"
            },
            "position": [
                700,
                200
            ]
        },
        {
            "name": "CMO Agent (Delegate)",
            "type": "n8n-nodes-base.executeWorkflow",
            "parameters": {
                "workflowId": "CMO_AGENT_ID"
            },
            "position": [
                700,
                300
            ]
        },
        {
            "name": "CIO Agent (Delegate)",
            "type": "n8n-nodes-base.executeWorkflow",
            "parameters": {
                "workflowId": "CIO_AGENT_ID"
            },
            "position": [
                700,
                400
            ]
        },
        {
            "name": "CimpO Agent (Delegate)",
            "type": "n8n-nodes-base.executeWorkflow",
            "parameters": {
                "workflowId": "CIMPO_AGENT_ID"
            },
            "position": [
                700,
                500
            ]
        },
        {
            "name": "Update Communications Status",
            "type": "n8n-nodes-base.httpRequest",
            "parameters": {
                "method": "PATCH",
                "url": "={{ $env.APPWRITE_ENDPOINT }}/databases/{{ $env.APPWRITE_DATABASE_ID }}/collections/Communications/documents/{{$json.communication_id}}",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "X-Appwrite-Project",
                            "value": "={{ $env.APPWRITE_PROJECT_ID }}"
                        },
                        {
                            "name": "X-Appwrite-Key",
                            "value": "={{ $env.APPWRITE_API_KEY }}"
                        },
                        {
                            "name": "Content-Type",
                            "value": "application/json"
                        }
                    ]
                },
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "{\n  \"data\": {\n    \"status\": \"processed\"\n  }\n}"
            },
            "position": [
                900,
                300
            ]
        }
    ],
    "connections": {
        "WhatsApp Bridge Webhook": {
            "main": [
                [
                    {
                        "node": "Strategy Engine (Gemini)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Strategy Engine (Gemini)": {
            "main": [
                [
                    {
                        "node": "C-Suite Router",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "C-Suite Router": {
            "To_CFO": [
                [
                    {
                        "node": "CFO Agent (Delegate)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ],
            "To_CTO": [
                [
                    {
                        "node": "CTO Agent (Delegate)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ],
            "To_CMO": [
                [
                    {
                        "node": "CMO Agent (Delegate)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ],
            "To_CIO": [
                [
                    {
                        "node": "CIO Agent (Delegate)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ],
            "To_CimpO": [
                [
                    {
                        "node": "CimpO Agent (Delegate)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    }
}