{
    "name": "L3 - Editor Agent",
    "description": "Content editor specialist - rewrites drafts to match Moseti's brand voice",
    "nodes": [
        {
            "name": "Trigger",
            "type": "n8n-nodes-base.webhook",
            "parameters": {
                "path": "editor-agent",
                "httpMethod": "POST"
            },
            "position": [
                100,
                300
            ]
        },
        {
            "name": "Load Draft from Appwrite",
            "type": "n8n-nodes-appwrite.appwrite",
            "parameters": {
                "operation": "getDocument",
                "databaseId": "693703ef001133c62d78",
                "collectionId": "Content_Drafts",
                "documentId": "={{$json.draft_id}}"
            },
            "position": [
                300,
                300
            ]
        },
        {
            "name": "Load Style Guide",
            "type": "n8n-nodes-base.httpRequest",
            "parameters": {
                "url": "https://raw.githubusercontent.com/fikanova/fikanova-hq/main/skills/CMO/Editor/Style_Guide.v1.md",
                "method": "GET"
            },
            "position": [
                300,
                450
            ]
        },
        {
            "name": "Gemini (Rewrite with Brand Voice)",
            "type": "@n8n/n8n-nodes-langchain.agent",
            "parameters": {
                "text": "You are Moseti's personal editor at Fikanova. Your job is to rewrite content to match his exact brand voice.\n\n## Style Guide:\n{{$node['Load Style Guide'].json.body}}\n\n## Original Draft:\n{{$node['Load Draft from Appwrite'].json.ai_draft}}\n\n## Content Type:\n{{$node['Load Draft from Appwrite'].json.content_type}}\n\n## Instructions:\n1. Rewrite to match the style guide EXACTLY\n2. Keep the core message intact\n3. Make it punchy and direct\n4. Reference the 3 Elements Theory where appropriate\n5. For X/Twitter: MAX 280 characters, no emojis unless specified\n6. For Newsletter: Short paragraphs, compelling subject line\n\n## Feedback (if any):\n{{$json.feedback || 'None'}}\n\nOutput ONLY the rewritten content, nothing else.",
                "options": {
                    "model": "gemini-1.5-flash"
                }
            },
            "position": [
                500,
                300
            ]
        },
        {
            "name": "Update Draft in Appwrite",
            "type": "n8n-nodes-appwrite.appwrite",
            "parameters": {
                "operation": "updateDocument",
                "databaseId": "693703ef001133c62d78",
                "collectionId": "Content_Drafts",
                "documentId": "={{$node['Load Draft from Appwrite'].json.$id}}",
                "data": {
                    "ai_draft": "={{$node['Gemini (Rewrite with Brand Voice)'].json.output}}",
                    "status": "review",
                    "updated_at": "={{new Date().toISOString()}}"
                }
            },
            "position": [
                700,
                300
            ]
        },
        {
            "name": "Notify via WhatsApp",
            "type": "n8n-nodes-base.httpRequest",
            "parameters": {
                "url": "{{$env.WHATSAPP_BRIDGE_URL}}",
                "method": "POST",
                "body": {
                    "direction": "outbound",
                    "to_phone": "{{$json.notify_phone || $env.FOUNDER_PHONE}}",
                    "message": "üìù Draft ready for review: {{$node['Load Draft from Appwrite'].json.title}}\n\nReply 'Approved' or send feedback.",
                    "agent_source": "Editor"
                }
            },
            "position": [
                900,
                300
            ]
        }
    ],
    "connections": {
        "Trigger": {
            "main": [
                [
                    {
                        "node": "Load Draft from Appwrite",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Load Draft from Appwrite": {
            "main": [
                [
                    {
                        "node": "Load Style Guide",
                        "type": "main",
                        "index": 0
                    },
                    {
                        "node": "Gemini (Rewrite with Brand Voice)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Load Style Guide": {
            "main": [
                [
                    {
                        "node": "Gemini (Rewrite with Brand Voice)",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Gemini (Rewrite with Brand Voice)": {
            "main": [
                [
                    {
                        "node": "Update Draft in Appwrite",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Update Draft in Appwrite": {
            "main": [
                [
                    {
                        "node": "Notify via WhatsApp",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    }
}